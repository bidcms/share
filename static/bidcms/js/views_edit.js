(function(rt){var templates=rt.templates,attrs=function(){return rt.attrs.apply(rt,arguments)},_=function(){return rt._.apply(rt,arguments)},img=function(){return rt.img.apply(rt,arguments)},imgURL=function(){return rt.imgURL.apply(rt,arguments)},imgSize=function(){return rt.imgSize.apply(rt,arguments)},avatar=function(){return rt.avatar.apply(rt,arguments)},url=function(){return rt.url.apply(rt,arguments)},mkurl=function(){return rt.mkurl.apply(rt,arguments)},escape=function(){return rt.escape.apply(rt,arguments)},__t=rt.templates,emerge=function(){return rt.renderSync.apply(rt,arguments)};__t["edit/board_edit"]=function(locals){var buf=[];with(locals||{}){var interp,board=page.board;buf.push("<div"),buf.push(attrs({"class":"hwfx"})),buf.push(">");var __val__=emerge("bidcms/header");buf.push(null==__val__?"":__val__),buf.push("</div><div"),buf.push(attrs({"class":"wfx"})),buf.push(">");var board_url="index.php?con=boards&act=item&id="+board.board_id;buf.push("<form"),buf.push(attrs({id:"BoardEdit",action:"index.php",method:"post",onsubmit:"return false;","class":"Form StaticForm"})),buf.push("><input"),buf.push(attrs({type:"hidden",id:"id_board_id",name:"board_id",value:""+board.board_id+""})),buf.push("><input type='hidden' name='commit' value='1'/>"),buf.push("<input type='hidden' name='con' value='board'/>"),buf.push("<input type='hidden' name='act' value='edit'/>"),buf.push("<h3>编辑画板 /&nbsp;<a"),buf.push(attrs({href:""+board_url+""})),buf.push(">"+escape((interp=board.title)==null?"":interp)+"</a></h3><ul><li><label"),buf.push(attrs({"for":"id_title"})),buf.push(">标题</label><div"),buf.push(attrs({"class":"Right"})),buf.push("><input"),buf.push(attrs({type:"text",name:"title",value:""+board.title+"",id:"id_title"})),buf.push("/></div></li><li><label"),buf.push(attrs({"for":"id_description"})),buf.push(">描述</label><div"),buf.push(attrs({"class":"Right"})),buf.push("><textarea"),buf.push(attrs({id:"id_description",rows:"3",cols:"40",name:"description"})),buf.push(">"+escape((interp=board.description)==null?"":interp)+"</textarea></div></li><li><label>分类</label><div"),buf.push(attrs({"class":"Right"})),buf.push("><input"),buf.push(attrs({type:"hidden",name:"category",id:"id_category",value:""+board.category_id+""})),buf.push("/>");var __val__=emerge("bidcms/category_picker");buf.push(null==__val__?"":__val__),buf.push("</div></li><li"),buf.push(attrs({"class":"Delete"})),buf.push("><label>删除</label><a"),buf.push(attrs({"data-url":"index.php?con=user&act=boards",href:"#",onclick:"return false;","class":"btn-del btn btn18 wbtn"})),buf.push('><strong> 删除画板</strong><span></span></a><!--if board.is_private--><!--  abtn.btn-hide(size="18", data-url="/#{board.user.urlname}/").disabled 画板已隐藏--><!--else--><!--  abtn.btn-hide(size="18", data-url="/#{board.user.urlname}/") 隐藏画板--></li></ul><div'),buf.push(attrs({"class":"Submit"})),buf.push("><a"),buf.push(attrs({href:"#",onclick:"return false;","class":"editpage_submit btn btn24 rbtn"})),buf.push('><strong> 保存设置</strong><span></span></a></div></form></div><script>(function(){var a=$("BoardEdit");if(a.retrieve("initialized"))return;var b=$("id_title"),c=$("id_description"),d=$("id_category"),e=$("id_board_id").get("value"),f=new CategoryPicker(a.getElement("div.CategoryPicker"));f.select(d.get("value")),new Button(a.getElement(".Submit a.btn"),{click:function(){var a=b.get("value").trim();if(a=="")return app.showTip(b,"请输入名称",{width:150});var d=f.getSelected();return d?(this.disable(),(new Request.JSON({url:"index.php",data:{id:e,commit:1,con:"boards",act:"edit",title:a,description:c.get("value"),category:d},onSuccess:function(a){a.err?app.error(a.msg):window.location="index.php?con=boards&act=item&id="+a.board.board_id},onFailure:function(){app.error("网络错误，请稍候再试")},onComplete:function(){this.enable()}.bind(this)})).post(),!1):app.showTip(f.element,"请选择分类",{width:150})}}),f.addEvent("select",function(){app.hideTip(f.element)}),$$("input").addEvent("blur",function(a){app.hideTip(a.target)});var g=a.getElement("a.btn-del");new Button(g,{click:function(){if(window.confirm("确定要删除这个画板吗？删除后这个画板内的所有采集都会被删除。")){var a=this;a.setTitle("正在删除...").disable(),(new Request.JSON({url:"index.php?con=boards&act=del&id="+e,data:{},onSuccess:function(b){if(b.err){app.error(b.msg||app.COMMON_ERRMSG),a.setTitle().enable();return}window.location=g.get("data-url")},onFailure:function(){a.setTitle().enable()}})).post()}return!1}})})()</script>')}return buf.join("")},__t["edit/pin_edit"]=function(locals){var buf=[];with(locals||{}){var interp,pin=page.pin;buf.push("<div"),buf.push(attrs({"class":"hwfx"})),buf.push(">");var __val__=emerge("bidcms/header");buf.push(null==__val__?"":__val__),buf.push("</div><div"),buf.push(attrs({"class":"wfx"})),buf.push("><div"),buf.push(attrs({id:"pin_edit_img","class":"pin"})),buf.push("><a"),buf.push(attrs({href:"index.php?con=pins&act=item&id="+pin.pin_id})),buf.push("><img"),buf.push(attrs({src:imgURL(pin.file,"fw192")})),buf.push("/></a><p>");var __val__=pin.raw_text.format_text(pin.text_meta);buf.push(null==__val__?"":__val__),buf.push("</p></div><form"),buf.push(attrs({id:"pin_edit_form",action:"",method:"post","class":"Form StaticForm"})),buf.push("><h3>编辑采集</h3><input"),buf.push(attrs({type:"hidden",name:"pin_id",value:""+pin.pin_id+"",id:"id_pin_id"})),buf.push("/><ul><li><label>描述</label><div"),buf.push(attrs({"class":"Right"})),buf.push("><div"),buf.push(attrs({id:"ta_holder","class":"editable_shadow pin_edit"})),buf.push("><textarea"),buf.push(attrs({rows:"2",name:"details",cols:"40",id:"description_pin_edit","class":"expand autocomplete_desc"})),buf.push(">"+escape((interp=pin.raw_text)==null?"":interp)+"</textarea></div></div></li><li><label"),buf.push(attrs({"for":"id_link"})),buf.push(">来自</label><div"),buf.push(attrs({"class":"Right"})),buf.push("><input"),buf.push(attrs({type:"text",name:"link",value:""+(pin.link||"")+"",id:"id_link"})),buf.push("/></div></li><li><label"),buf.push(attrs({"for":"id_board"})),buf.push(">画板</label><div"),buf.push(attrs({"class":"Right"})),buf.push("><input"),buf.push(attrs({type:"hidden",name:"board_id",value:""+pin.board_id+"",id:"id_board"})),buf.push("/>");var __val__=emerge("bidcms/board_picker");buf.push(null==__val__?"":__val__),buf.push("</div></li><li><label>删除</label><div"),buf.push(attrs({"class":"Right"})),buf.push("><a"),buf.push(attrs({href:"#",onclick:"return false;","class":"btn-del btn btn18 wbtn"})),buf.push("><strong> 删除采集</strong><span></span></a></div></li></ul><div"),buf.push(attrs({"class":"Submit"})),buf.push("><p><a"),buf.push(attrs({href:"#",onclick:"return false;","class":"btn btn24 rbtn"})),buf.push('><strong> 保存采集</strong><span></span></a></p></div></form></div><script>(function(){var a=$("pin_edit_form");if(a.retrieve("initialized"))return;var b=$("description_pin_edit"),c=$("id_link"),d=$("id_board"),e=$("id_pin_id").get("value"),f=d.get("value"),g=(new BoardPicker(a.getElement("div.BoardPicker"))).select(d.get("value"));new Button(a.getElement("div.Submit a.rbtn"),{click:function(){var a=b.get("value"),d=g.getSelected(),f=c.get("value"),h={board_id:d,text:a,link:f,id:e,con:"pins",act:"edit",commit:"1"},i=this;return i.setTitle("Saving...").disable(),(new Request.JSON({url:"index.php",data:h,onSuccess:function(a){if(a.err){alert(a.msg||app.COMMON_ERRMSG),i.setTitle().enable();return}window.location="index.php?con=pins&act=item&id="+e},onFailure:function(){i.setTitle().enable()}})).post(),!1}}),new Button(a.getElement("a.btn-del"),{click:function(){var a=this;return app.confirm("删除采集后不能恢复，确定要删除吗?",function(b){b&&(a.setTitle("正在删除...").disable(),(new Request.JSON({url:"index.php?con=pins&act=delete&id="+e,data:{_method:"DELETE"},onSuccess:function(b){if(b.err){alert(b.msg||app.COMMON_ERRMSG),a.setTitle().enable();return}var c="index.php?con=boards&act=item&id="+f;app.$pageCache.clear(c),app.go(c).addOnceEvent("switchPage",function(){app.msg("已经成功删除采集")})},onFailure:function(){a.setTitle().enable()}})).post())}),!1}}),b.get("registered-at")||(b.set("registered-at","registered"),new Autocompleter.Contacts.At(b)),a.store("initialized",!0)})()</script>')}return buf.join("")}})(app);